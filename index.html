<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WebARãƒ‡ãƒ¢ï¼ˆiOS Quick Look / Android Scene Viewer / Desktopãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</title>
    <!-- èª¬æ˜:
    - iOS: Quick Look (USDZ)
    - Android: Scene Viewer (GLB/GLTF)
    - Desktop: 3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ + QRã‚³ãƒ¼ãƒ‰ã§ã‚¹ãƒãƒ›ã¸
    - å¯èƒ½ãªã‚‰ <model-viewer> ã«ã‚ˆã‚‹3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼/ARèµ·å‹•
  -->

    <!-- 3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ï¼ˆGoogle model-viewerï¼‰
       å…¬å¼: https://modelviewer.dev/  -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

    <!-- Desktopâ†’ã‚¹ãƒãƒ›é·ç§»ç”¨ã®QRã‚³ãƒ¼ãƒ‰ï¼ˆè»½é‡ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ -->
    <script src="https://unpkg.com/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- äº‹å‰èª­ã¿è¾¼ã¿ï¼ˆä»»æ„ï¼‰ -->
    <link rel="preload" href="./model.usdz" as="fetch" crossorigin>
    <link rel="preload" href="./model.glb" as="fetch" crossorigin>

    <style>
        :root {
            --bg: #0b0f1a;
            --card: #111827;
            --muted: #9ca3af;
            --accent: #3b82f6;
            --text: #e5e7eb;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, sans-serif;
            background: radial-gradient(1200px 600px at 70% -10%, #0f172a 0%, var(--bg) 60%);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .wrap {
            width: 100%;
            max-width: 980px;
        }

        header {
            text-align: center;
            margin-bottom: 16px;
        }

        h1 {
            font-size: clamp(22px, 4vw, 32px);
            margin: 0 0 8px;
        }

        p.lead {
            color: var(--muted);
            margin: 0;
        }

        .grid {
            display: grid;
            gap: 16px;
            grid-template-columns: 1fr;
        }

        @media (min-width: 960px) {
            .grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.015));
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
            overflow: hidden;
        }

        model-viewer {
            width: 100%;
            height: 56vh;
            min-height: 360px;
            background: #0a0e1a;
        }

        .panel {
            padding: 16px;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .button,
        a.button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 600;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            transition: transform .06s ease, filter .15s ease;
        }

        .button.secondary {
            background: #334155;
        }

        .button.ghost {
            background: transparent;
            border: 1px solid #334155;
        }

        .button:hover {
            filter: brightness(1.08);
        }

        .button:active {
            transform: translateY(1px);
        }

        .hint {
            font-size: 12px;
            color: var(--muted);
            margin-top: 8px;
        }

        .qr-wrap {
            display: none;
            align-items: center;
            gap: 12px;
        }

        .qr-box {
            width: 140px;
            height: 140px;
            padding: 8px;
            border-radius: 12px;
            background: white;
            display: grid;
            place-items: center;
        }

        footer {
            margin-top: 18px;
            text-align: center;
            color: var(--muted);
            font-size: 12px;
        }

        code {
            background: rgba(255, 255, 255, 0.08);
            padding: 2px 6px;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <h1>ARã§è¦‹ã‚‹</h1>
            <p class="lead">iOS / Android / Desktop ã©ã‚Œã§ã‚‚OKã€‚ã¾ãšã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ç«¯æœ«ã«å¿œã˜ã¦æœ€é©ãªARã‚’èµ·å‹•ã—ã¾ã™ã€‚</p>
        </header>

        <div class="grid">
            <!-- å·¦: 3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div class="card">
                <!--
          src: Android/ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ï¼ˆglb/gltfï¼‰
          ios-src: iOS Quick Lookç”¨ï¼ˆusdzï¼‰
          ar-modes: å¯èƒ½ãªARèµ·å‹•æ‰‹æ®µã‚’åˆ—æŒ™
        -->
                <model-viewer id="viewer" src="./model.glb" ios-src="./model.usdz" ar
                    ar-modes="quick-look scene-viewer webxr" camera-controls auto-rotate shadow-intensity="1"
                    exposure="1.0" alt="3Dãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">

                    <!-- model-viewer å†…ã®ARãƒœã‚¿ãƒ³ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ -->
                    <button slot="ar-button" class="button">ğŸ“± ARã§è¡¨ç¤º</button>
                    <div class="hint" slot="poster">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
                </model-viewer>
            </div>

            <!-- å³: æ“ä½œãƒ‘ãƒãƒ« -->
            <div class="card panel">
                <h2 style="margin-top:0">ç«¯æœ«ã«åˆã‚ã›ã¦ARèµ·å‹•</h2>
                <div class="buttons" style="margin-bottom:8px">
                    <!-- iOS Quick Look: a[rel=ar] ãŒæœ€çŸ­ -->
                    <a id="btn-ios" class="button" rel="ar" href="./model.usdz" title="iPhone / iPad ç”¨">
                        ï£¿ iPhone / iPad ã§AR
                    </a>

                    <!-- Android Scene Viewer: intent URLã‚’ç”Ÿæˆ -->
                    <a id="btn-android" class="button secondary" href="#" title="Android ç”¨">
                        ğŸ¤– Androidã§AR
                    </a>

                    <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: QRã‚³ãƒ¼ãƒ‰ or å…±æœ‰ãƒªãƒ³ã‚¯ -->
                    <button id="btn-desktop" class="button ghost" title="ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å‘ã‘">
                        ğŸ–¥ï¸ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—â†’ã‚¹ãƒãƒ›
                    </button>
                </div>
                <div id="qr" class="qr-wrap">
                    <div class="qr-box">
                        <div id="qrcode"></div>
                    </div>
                    <div>
                        <div>ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§QRã‚’èª­ã¿å–ã£ã¦ã€ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚</div>
                        <div class="hint">åŒã˜Wiâ€‘Fiã§ãªã„å ´åˆã¯ã€ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°URLãŒå¤–éƒ¨ã‹ã‚‰åˆ°é”å¯èƒ½ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.06); margin:16px 0;">
                <details>
                    <summary>ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¡ãƒ¢</summary>
                    <ul style="margin:8px 0 0 16px; color: var(--muted); font-size: 14px;">
                        <li><code>./model.usdz</code>ï¼ˆiOSå‘ã‘ï¼‰ã¨<code>./model.glb</code>ï¼ˆAndroid/ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‘ã‘ï¼‰ã‚’åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã€‚</li>
                        <li>Androidã®Scene Viewerã¯HTTPSã‹ã¤å…¬é–‹URLæ¨å¥¨ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã®å ´åˆã¯USBãƒ‡ãƒãƒƒã‚°ã‹ã‚‰é–‹ç™ºè€…ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç­‰ã§æ¤œè¨¼ã€‚</li>
                        <li>Quick Lookã®æŒ™å‹•ï¼ˆå›ºå®šã‚¹ã‚±ãƒ¼ãƒ«ç­‰ï¼‰ã¯USDZå´ã®è¨­å®šã«ä¾å­˜ã—ã¾ã™ã€‚</li>
                    </ul>
                </details>
            </div>
        </div>

        <footer>
            <span>ARèµ·å‹•ãŒã†ã¾ãã„ã‹ãªã„æ™‚ã¯ã€ç«¯æœ«ã®OS/ãƒ–ãƒ©ã‚¦ã‚¶ã®æœ€æ–°ç‰ˆã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</span>
        </footer>
    </div>

    <script>
        // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: ç«¯æœ«åˆ¤å®š ---
        const ua = navigator.userAgent || navigator.vendor || window.opera;
        const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        const isAndroid = /Android/.test(ua);

        // --- è¦ç´ å‚ç…§ ---
        const btnIOS = document.getElementById('btn-ios');
        const btnAndroid = document.getElementById('btn-android');
        const btnDesktop = document.getElementById('btn-desktop');
        const qrWrap = document.getElementById('qr');

        // --- Android Scene Viewer intent URLã‚’æ§‹ç¯‰ ---
        function buildSceneViewerUrl(params) {
            const base = 'https://arvr.google.com/scene-viewer/1.0';
            const url = new URL(base);
            Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));
            return url.toString();
        }

        // ã“ã“ã¯å…¬é–‹URLã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼ˆåŒä¸€ã‚ªãƒªã‚¸ãƒ³æ¨å¥¨ï¼‰
        const glbUrl = new URL('./model.glb', location.href).toString();

        // Androidãƒœã‚¿ãƒ³ã®hrefã‚’è¨­å®š
        const sceneViewerURL = buildSceneViewerUrl({
            file: glbUrl,
            mode: 'ar_only',
            title: document.title || 'WebAR Model',
            // link ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æˆ»ã‚Šå…ˆï¼ˆä»»æ„ï¼‰
            link: location.href
        });
        btnAndroid.href = sceneViewerURL;

        // --- ç«¯æœ«åˆ¥ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒœã‚¿ãƒ³ã‚’å¼·èª¿è¡¨ç¤º ---
        if (isIOS) {
            btnIOS.classList.remove('secondary', 'ghost');
        } else if (isAndroid) {
            btnAndroid.classList.remove('secondary');
            btnAndroid.classList.add('button');
        } else {
            btnDesktop.classList.remove('ghost');
            btnDesktop.classList.add('button');
        }

        // --- Desktop: QRã‚³ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤º ---
        let qrRendered = false;
        btnDesktop?.addEventListener('click', () => {
            qrWrap.style.display = qrWrap.style.display === 'flex' ? 'none' : 'flex';
            if (!qrRendered) {
                // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸URLã‚’QRåŒ–
                // å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹URLã§ãƒ›ã‚¹ãƒˆã—ã¦ãã ã•ã„
                new QRCode(document.getElementById('qrcode'), {
                    text: location.href,
                    width: 120,
                    height: 120,
                    correctLevel: QRCode.CorrectLevel.M
                });
                qrRendered = true;
            }
        });

        // --- Web Share APIï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰---
        if (navigator.share) {
            const shareBtn = document.createElement('button');
            shareBtn.textContent = 'ğŸ“¤ å…±æœ‰';
            shareBtn.className = 'button ghost';
            shareBtn.style.marginLeft = '8px';
            shareBtn.addEventListener('click', async () => {
                try {
                    await navigator.share({ title: document.title, url: location.href });
                } catch (e) { /* ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãªã© */ }
            });
            document.querySelector('.buttons').appendChild(shareBtn);
        }

        // --- ã¡ã‚‡ã„ä¸Šç´š: iOSã§ã®å³æ™‚Quick Lookèµ·å‹•ï¼ˆä»»æ„ï¼‰ ---
        // ãƒšãƒ¼ã‚¸è¡¨ç¤ºã¨åŒæ™‚ã«èµ·å‹•ã—ãŸã„å ´åˆãªã©ã¯ä»¥ä¸‹ã‚’æ´»ç”¨ï¼ˆUXã«æ³¨æ„ï¼‰
        // if (isIOS) {
        //   const a = document.createElement('a');
        //   a.setAttribute('rel', 'ar');
        //   a.setAttribute('href', './model.usdz');
        //   a.style.display = 'none';
        //   document.body.appendChild(a);
        //   a.click();
        //   a.remove();
        // }
    </script>
</body>

</html>